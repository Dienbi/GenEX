{% extends 'main/base.html' %}
{% load static %}

{% block title %}Game Results - {{ room.room_code }}{% endblock %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
    }

    .results-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 20px;
    }

    .results-header {
        background: white;
        border-radius: 15px;
        padding: 40px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        text-align: center;
    }

    .winner-badge {
        font-size: 3rem;
        margin-bottom: 20px;
    }

    .results-title {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .results-title.winner {
        color: #28a745;
    }

    .results-title.loser {
        color: #dc3545;
    }

    .results-title.tie {
        color: #ffc107;
    }

    .final-scores {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 30px;
        margin-top: 30px;
    }

    .score-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
    }

    .score-card.winner {
        border: 4px solid #28a745;
    }

    .player-name {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .final-score {
        font-size: 3rem;
        font-weight: 700;
        color: #dc3545;
    }

    .vs-separator {
        display: flex;
        align-items: center;
        font-size: 2rem;
        font-weight: 700;
        color: #666;
    }

    .detailed-results {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .detailed-results h2 {
        font-size: 2rem;
        color: #333;
        margin-bottom: 30px;
        text-align: center;
    }

    .question-result {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 20px;
        border: 2px solid #eee;
    }

    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #ddd;
    }

    .question-number {
        font-weight: 700;
        font-size: 1.1rem;
        color: #007bff;
    }

    .question-text {
        font-size: 1.2rem;
        color: #333;
        margin-bottom: 20px;
        font-weight: 600;
    }

    .players-answers {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .player-answer {
        background: white;
        border-radius: 8px;
        padding: 15px;
        border: 2px solid #ddd;
    }

    .player-answer-header {
        font-weight: 600;
        margin-bottom: 10px;
        color: #666;
    }

    .answer-text {
        font-size: 1.1rem;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 5px;
    }

    .answer-correct {
        background: #d4edda;
        color: #155724;
        border: 2px solid #c3e6cb;
    }

    .answer-incorrect {
        background: #f8d7da;
        color: #721c24;
        border: 2px solid #f5c6cb;
    }

    .answer-points {
        font-weight: 600;
        color: #666;
        font-size: 0.9rem;
    }

    .correct-answer-info {
        margin-top: 15px;
        padding: 10px;
        background: #d1ecf1;
        color: #0c5460;
        border-radius: 5px;
        font-weight: 600;
    }

    .action-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
    }

    .btn {
        padding: 15px 40px;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 10px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(0,123,255,0.4);
    }

    .btn-secondary {
        background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        color: white;
    }

    .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(108,117,125,0.4);
    }

    @media (max-width: 768px) {
        .final-scores {
            grid-template-columns: 1fr;
        }

        .players-answers {
            grid-template-columns: 1fr;
        }

        .action-buttons {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="results-container">
    <div class="results-header">
        {% if is_winner %}
            <div class="winner-badge">üèÜ</div>
            <h1 class="results-title winner">Victory!</h1>
            <p style="font-size: 1.3rem; color: #666;">Congratulations, you won!</p>
        {% elif is_tie %}
            <div class="winner-badge">ü§ù</div>
            <h1 class="results-title tie">It's a Tie!</h1>
            <p style="font-size: 1.3rem; color: #666;">Great match! You both scored the same.</p>
        {% else %}
            <div class="winner-badge">üí™</div>
            <h1 class="results-title loser">Good Try!</h1>
            <p style="font-size: 1.3rem; color: #666;">Better luck next time!</p>
        {% endif %}

        <div class="final-scores">
            <div class="score-card {% if room.winner == room.player1 %}winner{% endif %}">
                <div class="player-name">
                    <i class="fas fa-user"></i> {{ room.player1.username }}
                </div>
                <div class="final-score">{{ room.player1_score }}</div>
                <small>points</small>
            </div>

            <div class="vs-separator">VS</div>

            <div class="score-card {% if room.winner == room.player2 %}winner{% endif %}">
                <div class="player-name">
                    <i class="fas fa-user"></i> {{ room.player2.username|default:"Player 2" }}
                </div>
                <div class="final-score">{{ room.player2_score }}</div>
                <small>points</small>
            </div>
        </div>
    </div>

    <div class="detailed-results">
        <h2><i class="fas fa-chart-bar"></i> Detailed Results</h2>

        {% for item in questions_data %}
            <div class="question-result">
                <div class="question-header">
                    <span class="question-number">Question {{ item.question.order }}</span>
                </div>

                <div class="question-text">{{ item.question.question_text }}</div>

                <div class="players-answers">
                    <!-- Player 1 Answer -->
                    <div class="player-answer">
                        <div class="player-answer-header">
                            <i class="fas fa-user"></i> {{ room.player1.username }}
                        </div>
                        {% if item.player1_answer %}
                            <div class="answer-text {% if item.player1_answer.is_correct %}answer-correct{% else %}answer-incorrect{% endif %}">
                                <strong>{{ item.player1_answer.answer }}.</strong>
                                {% if item.player1_answer.answer == 'A' %}
                                    {{ item.question.option_a }}
                                {% elif item.player1_answer.answer == 'B' %}
                                    {{ item.question.option_b }}
                                {% elif item.player1_answer.answer == 'C' %}
                                    {{ item.question.option_c }}
                                {% elif item.player1_answer.answer == 'D' %}
                                    {{ item.question.option_d }}
                                {% endif %}
                            </div>
                            <div class="answer-points">
                                {% if item.player1_answer.is_correct %}
                                    <i class="fas fa-check-circle" style="color: #28a745;"></i> Correct
                                {% else %}
                                    <i class="fas fa-times-circle" style="color: #dc3545;"></i> Incorrect
                                {% endif %}
                                | +{{ item.player1_answer.points_earned }} pts | {{ item.player1_answer.time_taken|floatformat:1 }}s
                            </div>
                        {% else %}
                            <div class="answer-text" style="background: #e9ecef; color: #666;">
                                <i>No answer</i>
                            </div>
                        {% endif %}
                    </div>

                    <!-- Player 2 Answer -->
                    <div class="player-answer">
                        <div class="player-answer-header">
                            <i class="fas fa-user"></i> {{ room.player2.username|default:"Player 2" }}
                        </div>
                        {% if item.player2_answer %}
                            <div class="answer-text {% if item.player2_answer.is_correct %}answer-correct{% else %}answer-incorrect{% endif %}">
                                <strong>{{ item.player2_answer.answer }}.</strong>
                                {% if item.player2_answer.answer == 'A' %}
                                    {{ item.question.option_a }}
                                {% elif item.player2_answer.answer == 'B' %}
                                    {{ item.question.option_b }}
                                {% elif item.player2_answer.answer == 'C' %}
                                    {{ item.question.option_c }}
                                {% elif item.player2_answer.answer == 'D' %}
                                    {{ item.question.option_d }}
                                {% endif %}
                            </div>
                            <div class="answer-points">
                                {% if item.player2_answer.is_correct %}
                                    <i class="fas fa-check-circle" style="color: #28a745;"></i> Correct
                                {% else %}
                                    <i class="fas fa-times-circle" style="color: #dc3545;"></i> Incorrect
                                {% endif %}
                                | +{{ item.player2_answer.points_earned }} pts | {{ item.player2_answer.time_taken|floatformat:1 }}s
                            </div>
                        {% else %}
                            <div class="answer-text" style="background: #e9ecef; color: #666;">
                                <i>No answer</i>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="correct-answer-info">
                    <i class="fas fa-lightbulb"></i> Correct Answer: <strong>{{ item.question.correct_answer }}.</strong>
                    {% if item.question.correct_answer == 'A' %}
                        {{ item.question.option_a }}
                    {% elif item.question.correct_answer == 'B' %}
                        {{ item.question.option_b }}
                    {% elif item.question.correct_answer == 'C' %}
                        {{ item.question.option_c }}
                    {% elif item.question.correct_answer == 'D' %}
                        {{ item.question.option_d }}
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

    <div class="action-buttons">
        <a href="{% url 'quizzes:challenge_home' %}" class="btn btn-primary">
            <i class="fas fa-redo"></i> Play Again
        </a>
        <a href="{% url 'quizzes:my_matches' %}" class="btn btn-primary">
            <i class="fas fa-history"></i> View Match History
        </a>
        <a href="{% url 'quizzes:home' %}" class="btn btn-secondary">
            <i class="fas fa-home"></i> Back to Quiz Hub
        </a>
    </div>
</div>
{% endblock %}

