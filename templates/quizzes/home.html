{% extends 'main/base.html' %}

{% block title %}Quiz Hub - GenEX{% endblock %}

{% block extra_css %}
<style>
    .quiz-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .quiz-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        padding: 40px;
        border-radius: 10px;
        margin-bottom: 40px;
        text-align: center;
    }

    .quiz-header h1 {
        font-size: 36px;
        margin-bottom: 10px;
    }

    .quiz-header p {
        font-size: 18px;
        opacity: 0.9;
    }

    .header-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .generate-btn {
        display: inline-block;
        background: #fff;
        color: #667eea;
        padding: 15px 40px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 700;
        font-size: 18px;
        transition: all 0.3s;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .generate-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }

    .generate-btn i {
        margin-right: 10px;
    }

    .available-btn {
        display: inline-block;
        background: #28a745;
        color: #fff;
        padding: 15px 40px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 700;
        font-size: 18px;
        transition: all 0.3s;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        border: 2px solid #28a745;
    }

    .available-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        background: #218838;
        border-color: #218838;
    }

    .available-btn i {
        margin-right: 10px;
    }

    .available-btn .badge {
        background: #fff;
        color: #28a745;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 14px;
        margin-left: 8px;
        font-weight: 800;
    }

    .section-title {
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 3px solid #667eea;
    }

    .quiz-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
        margin-bottom: 50px;
    }

    .quiz-card {
        background: #fff;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        transition: all 0.3s;
        border-left: 5px solid #667eea;
    }

    .quiz-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }

    .quiz-card h3 {
        font-size: 20px;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .quiz-meta {
        color: #7f8c8d;
        font-size: 14px;
        margin-bottom: 15px;
    }

    .quiz-meta i {
        margin-right: 5px;
    }

    .quiz-subject {
        background: #ecf0f1;
        color: #667eea;
        padding: 5px 15px;
        border-radius: 20px;
        display: inline-block;
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 15px;
    }

    .take-quiz-btn {
        display: inline-block;
        background: #667eea;
        color: #fff;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
        width: 100%;
        text-align: center;
    }

    .take-quiz-btn:hover {
        background: #5568d3;
    }

    .attempt-item {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s;
        gap: 20px;
    }

    .attempt-item:hover {
        box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }

    .attempt-actions {
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
    }

    .view-details-btn {
        padding: 8px 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }

    .view-details-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(102, 126, 234, 0.4);
    }

    .attempt-info h4 {
        font-size: 18px;
        color: #2c3e50;
        margin-bottom: 5px;
    }

    .attempt-info p {
        color: #7f8c8d;
        font-size: 14px;
        margin: 0;
    }

    .attempt-score {
        text-align: right;
    }

    .score-value {
        font-size: 32px;
        font-weight: 700;
        color: #667eea;
    }

    .score-label {
        font-size: 14px;
        color: #7f8c8d;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #95a5a6;
    }

    .empty-state i {
        font-size: 60px;
        margin-bottom: 20px;
        color: #ddd;
    }

    .empty-state p {
        font-size: 18px;
    }

    /* Streak Stats Section */
    .streak-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .streak-card {
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        text-align: center;
        transition: all 0.3s;
    }

    .streak-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }

    .streak-card.current {
        border-left: 5px solid #ff6b35;
    }

    .streak-card.longest {
        border-left: 5px solid #f7b731;
    }

    .streak-icon {
        font-size: 48px;
        margin-bottom: 15px;
    }

    .streak-number {
        font-size: 56px;
        font-weight: 800;
        line-height: 1;
        margin-bottom: 10px;
    }

    .streak-card.current .streak-number {
        color: #ff6b35;
    }

    .streak-card.longest .streak-number {
        color: #f7b731;
    }

    .streak-label {
        font-size: 16px;
        color: #7f8c8d;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
    }

    .streak-timer {
        margin-top: 10px;
        font-size: 13px;
        color: #95a5a6;
    }

    .streak-timer.warning {
        color: #e74c3c;
        font-weight: 600;
    }

    /* Leaderboard Section */
    .leaderboard-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 25px;
        margin-bottom: 50px;
    }

    .leaderboard-card {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .leaderboard-header {
        padding: 25px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        text-align: center;
    }

    .leaderboard-header.current {
        background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    }

    .leaderboard-header.longest {
        background: linear-gradient(135deg, #f7b731 0%, #ffa502 100%);
    }

    .leaderboard-header h3 {
        font-size: 22px;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .leaderboard-header .icon {
        font-size: 32px;
    }

    .leaderboard-list {
        padding: 10px;
    }

    .leaderboard-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px 20px;
        border-bottom: 1px solid #ecf0f1;
        transition: all 0.3s;
    }

    .leaderboard-item:hover {
        background: #f8f9fa;
        transform: translateX(5px);
    }

    .leaderboard-item:last-child {
        border-bottom: none;
    }

    .leaderboard-rank {
        font-size: 20px;
        font-weight: 800;
        width: 40px;
        text-align: center;
    }

    .leaderboard-rank.gold {
        color: #f7b731;
    }

    .leaderboard-rank.silver {
        color: #95a5a6;
    }

    .leaderboard-rank.bronze {
        color: #cd7f32;
    }

    .leaderboard-user {
        flex: 1;
        margin-left: 15px;
    }

    .leaderboard-username {
        font-weight: 600;
        color: #2c3e50;
        font-size: 16px;
    }

    .leaderboard-username.current-user {
        color: #667eea;
        font-weight: 700;
    }

    .leaderboard-username.current-user::before {
        content: "👤 ";
    }

    .leaderboard-streak {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 20px;
        font-weight: 700;
    }

    .leaderboard-streak.current {
        color: #ff6b35;
    }

    .leaderboard-streak.longest {
        color: #f7b731;
    }

    .leaderboard-empty {
        padding: 40px 20px;
        text-align: center;
        color: #95a5a6;
    }

    .leaderboard-empty i {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
    }

    .medal-icon {
        font-size: 24px;
        margin-right: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="quiz-container">
    <!-- Header -->
    <div class="quiz-header">
        <h1><i class="fas fa-brain"></i> AI Quiz Generator</h1>
        <p>Generate custom quizzes on any topic using AI technology</p>
        <div class="header-buttons">
            <a href="{% url 'quizzes:generate' %}" class="generate-btn">
                <i class="fas fa-plus-circle"></i> Generate New Quiz
            </a>
            {% if available_quizzes %}
            <a href="#available-quizzes" class="available-btn">
                <i class="fas fa-star"></i> Available Quizzes
                <span class="badge">{{ available_quizzes|length }}</span>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Streak Stats -->
    <div class="streak-section">
        <div class="streak-card current">
            <div class="streak-icon">🔥</div>
            <div class="streak-number">{{ current_streak }}</div>
            <div class="streak-label">Current Streak</div>
            {% if current_streak > 0 and not time_until_expires.expired %}
                <div class="streak-timer {% if time_until_expires.hours_remaining < 5 %}warning{% endif %}">
                    ⏰ {{ time_until_expires.hours_remaining|floatformat:0 }}h remaining
                </div>
            {% elif current_streak > 0 %}
                <div class="streak-timer">
                    ✅ Complete a quiz tomorrow!
                </div>
            {% else %}
                <div class="streak-timer">
                    🎯 Start your streak today!
                </div>
            {% endif %}
        </div>

        <div class="streak-card longest">
            <div class="streak-icon">🏆</div>
            <div class="streak-number">{{ longest_streak }}</div>
            <div class="streak-label">Longest Streak</div>
            {% if longest_streak > 0 %}
                <div class="streak-timer">
                    🎉 Personal Best!
                </div>
            {% else %}
                <div class="streak-timer">
                    💪 Take your first quiz!
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Leaderboard -->
    <h2 class="section-title"><i class="fas fa-trophy"></i> Leaderboard</h2>
    <div class="leaderboard-section">
        <!-- Top Current Streaks -->
        <div class="leaderboard-card">
            <div class="leaderboard-header current">
                <h3>
                    <span class="icon">🔥</span>
                    Top Current Streaks
                </h3>
            </div>
            <div class="leaderboard-list">
                {% if top_current_streaks %}
                    {% for user in top_current_streaks %}
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank {% if forloop.counter == 1 %}gold{% elif forloop.counter == 2 %}silver{% elif forloop.counter == 3 %}bronze{% endif %}">
                            {% if forloop.counter == 1 %}
                                <span class="medal-icon">🥇</span>
                            {% elif forloop.counter == 2 %}
                                <span class="medal-icon">🥈</span>
                            {% elif forloop.counter == 3 %}
                                <span class="medal-icon">🥉</span>
                            {% else %}
                                {{ forloop.counter }}
                            {% endif %}
                        </div>
                        <div class="leaderboard-user">
                            <div class="leaderboard-username {% if user.id == request.user.id %}current-user{% endif %}">
                                {{ user.username }}
                            </div>
                        </div>
                        <div class="leaderboard-streak current">
                            🔥 {{ user.current_streak }}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="leaderboard-empty">
                        <i class="fas fa-trophy"></i>
                        <p>No active streaks yet. Be the first!</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Top Longest Streaks -->
        <div class="leaderboard-card">
            <div class="leaderboard-header longest">
                <h3>
                    <span class="icon">🏆</span>
                    Top Longest Streaks
                </h3>
            </div>
            <div class="leaderboard-list">
                {% if top_longest_streaks %}
                    {% for user in top_longest_streaks %}
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank {% if forloop.counter == 1 %}gold{% elif forloop.counter == 2 %}silver{% elif forloop.counter == 3 %}bronze{% endif %}">
                            {% if forloop.counter == 1 %}
                                <span class="medal-icon">🥇</span>
                            {% elif forloop.counter == 2 %}
                                <span class="medal-icon">🥈</span>
                            {% elif forloop.counter == 3 %}
                                <span class="medal-icon">🥉</span>
                            {% else %}
                                {{ forloop.counter }}
                            {% endif %}
                        </div>
                        <div class="leaderboard-user">
                            <div class="leaderboard-username {% if user.id == request.user.id %}current-user{% endif %}">
                                {{ user.username }}
                            </div>
                        </div>
                        <div class="leaderboard-streak longest">
                            🏆 {{ user.longest_streak }}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="leaderboard-empty">
                        <i class="fas fa-trophy"></i>
                        <p>No streaks recorded yet. Start yours today!</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Available Quizzes from Admins -->
    {% if available_quizzes %}
    <div id="available-quizzes"></div>
    <h2 class="section-title"><i class="fas fa-star"></i> Available Quizzes</h2>
    <div class="quiz-grid">
        {% for quiz in available_quizzes %}
        <div class="quiz-card" style="border-left-color: #28a745;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                <span class="quiz-subject" style="background: #e7f3ff; color: #0066cc; font-weight: 700;">{{ quiz.subject }}</span>
                <span style="font-size: 11px; background: #ffc107; color: #333; padding: 4px 8px; border-radius: 12px; font-weight: 600;">
                    <i class="fas fa-user-shield"></i> Admin
                </span>
            </div>
            <h3>{{ quiz.title }}</h3>
            <div class="quiz-meta">
                <i class="fas fa-calendar"></i> {{ quiz.created_at|date:"M d, Y" }}
                <span style="margin-left: 15px;">
                    <i class="fas fa-question-circle"></i> {{ quiz.questions.count }} questions
                </span>
            </div>
            {% if quiz.user_attempted %}
                <div style="margin: 10px 0; padding: 8px; background: #d4edda; border-radius: 5px; font-size: 13px; color: #155724;">
                    <i class="fas fa-check-circle"></i> Attempted {{ quiz.attempt_count }}x
                </div>
            {% endif %}
            <a href="{% url 'quizzes:take_quiz' quiz.id %}" class="take-quiz-btn" style="background: #dc3545 !important; border-color: #dc3545 !important;">
                <i class="fas fa-{% if quiz.user_attempted %}redo{% else %}play{% endif %}"></i> 
                {% if quiz.user_attempted %}Retake Quiz{% else %}Take Quiz{% endif %}
            </a>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Recent Attempts -->
    <h2 class="section-title"><i class="fas fa-history"></i> Recent Attempts</h2>
    {% if user_attempts %}
        {% for attempt in user_attempts %}
        <div class="attempt-item">
            <div class="attempt-info">
                <h4>{{ attempt.quiz.title }}</h4>
                <p>
                    <i class="fas fa-calendar"></i> {{ attempt.completed_at|date:"M d, Y H:i" }}
                </p>
                <p style="margin-top: 5px;">
                    <i class="fas fa-book"></i> Subject: <strong>{{ attempt.quiz.subject }}</strong>
                </p>
            </div>
            <div class="attempt-actions">
                <div class="attempt-score">
                    <div class="score-value">{{ attempt.percentage|floatformat:0 }}%</div>
                    <div class="score-label">{{ attempt.score }}/{{ attempt.total_questions }}</div>
                </div>
                <a href="{% url 'quizzes:quiz_results' attempt.id %}" class="view-details-btn">
                    <i class="fas fa-eye"></i> View Details
                </a>
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="empty-state">
        <i class="fas fa-clipboard-check"></i>
        <p>No quiz attempts yet. Take a quiz to see your results!</p>
    </div>
    {% endif %}
</div>

<script>
// Smooth scroll to Available Quizzes section
document.addEventListener('DOMContentLoaded', function() {
    const availableBtn = document.querySelector('.available-btn');
    if (availableBtn) {
        availableBtn.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector('#available-quizzes');
            if (target) {
                target.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    }
});
</script>
{% endblock %}

